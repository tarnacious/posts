<div class="entry">
<p>I’ve got a tiny Acer Aspire “netbook” I use while commuting to work. It’s a very low spec’d machine but it has a very functional keyboard and I love programming on it!</p> <p>I think I enjoy programming on it because it <em>doesn’t</em> have Visual Studios installed. I have the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=e6e1c3df-a74f-4207-8586-711ebe331cdc&amp;displaylang=en">Windows SDK</a> so I can build .NET projects with MsBuild, but I mainly use it for developing Python code. With some free tools and <a href="http://notepad-plus.sourceforge.net/uk/site.htm">notepad++</a> <a href="http://sourceforge.net/projects/npp-plugins/">plug-ins</a> its a great light weight environment for coding simple Django and Google App Engine web applications and dynamic language .NET applications. </p> <p>I’m not really into computer gaming, but I do like 2d physics games. I remember losing days work when I first found <a href="http://magic.pen.fizzlebot.com/">Magic Pen</a>. I decided to try using the cool <a href="http://www.codeplex.com/FarseerPhysics">Farseer Physics Engine</a>, which is described on the Codeplex page as;&#160; </p> <blockquote> <p>The Farseer Physics Engine is an easy to use 2D physics engine designed for Microsoft’s <b>XNA</b> and <b>Silverlight</b> platforms. The Farseer Physics Engine focuses on simplicity, useful features, and enabling the creation of fun, dynamic games. </p> </blockquote> <h2>Getting started</h2> <p>The Farseer engine is written in C# and I found once I’d installed the <a href="http://www.microsoft.com/downloads/details.aspx?familyid=9442b0f2-7465-417a-88f3-5e7b5409e9dd&amp;displaylang=en">Silverlight SDK</a> I could use MSBuild to build the Farseer engine that targets the Silverlight runtime. The Farseer engine doesn’t itself reference anything Silverlight specific, but it does need to be built against the limited .NET framework available in Silverlight.</p> <p>I’ve <a href="http://blog.sharpthinking.com.au/post/2009/01/26/Silverlight-Dynamic-Languages-SDK.aspx">previously blogged</a> about writing dynamic language Silverlight applications; the <a title="http://sdlsdk.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=25120" href="http://sdlsdk.codeplex.com/">Silverlight Dynamic Languages SDK</a> contains the Silverlight IronPython assemblies and a command line application called Chiron. Chiron is a web server that runs from the command line and dynamically packages up XAPs as they are requested.&#160; </p> <h2>A little about XAPs</h2> <p>XAPs are packaged Silverlight applications that are downloaded and run on the clients Silverlight runtime. It turns out the XAP is just zip files containing the assemblies, resources and in the case of dynamic language applications, some plain text source code! </p> <p>Additionally there is an AppManifest.xaml included in the XAP which tells Silverlight about what is included in the XAP and where to find an entry point. Below is an example of an AppManifest.xaml automatically generated by Chiron.</p> <div id="codeSnippetWrapper"> <pre id="codeSnippet" style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; direction: ltr; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; text-align: left; border-bottom-style: none"><span style="color: #0000ff">&lt;</span><span style="color: #800000">Deployment</span> <span style="color: #ff0000">xmlns</span><span style="color: #0000ff">=&quot;http://schemas.microsoft.com/client/2007/deployment&quot;</span> <br />            <span style="color: #ff0000">xmlns:x</span><span style="color: #0000ff">=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span> <br />            <span style="color: #ff0000">RuntimeVersion</span><span style="color: #0000ff">=&quot;2.0.31005.0&quot;</span> <br />            <span style="color: #ff0000">EntryPointAssembly</span><span style="color: #0000ff">=&quot;Microsoft.Scripting.Silverlight&quot;</span> <br />            <span style="color: #ff0000">EntryPointType</span><span style="color: #0000ff">=&quot;Microsoft.Scripting.Silverlight.DynamicApplication&quot;</span><span style="color: #0000ff">&gt;</span><br />  <span style="color: #0000ff">&lt;</span><span style="color: #800000">Deployment.Parts</span><span style="color: #0000ff">&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">AssemblyPart</span> <span style="color: #ff0000">Source</span><span style="color: #0000ff">=&quot;Microsoft.Scripting.Silverlight.dll&quot;</span> <span style="color: #0000ff">/&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">AssemblyPart</span> <span style="color: #ff0000">Source</span><span style="color: #0000ff">=&quot;Microsoft.Scripting.ExtensionAttribute.dll&quot;</span> <span style="color: #0000ff">/&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">AssemblyPart</span> <span style="color: #ff0000">Source</span><span style="color: #0000ff">=&quot;Microsoft.Scripting.Core.dll&quot;</span> <span style="color: #0000ff">/&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">AssemblyPart</span> <span style="color: #ff0000">Source</span><span style="color: #0000ff">=&quot;Microsoft.Scripting.dll&quot;</span> <span style="color: #0000ff">/&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">AssemblyPart</span> <span style="color: #ff0000">Source</span><span style="color: #0000ff">=&quot;IronPython.dll&quot;</span> <span style="color: #0000ff">/&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">AssemblyPart</span> <span style="color: #ff0000">Source</span><span style="color: #0000ff">=&quot;IronPython.Modules.dll&quot;</span> <span style="color: #0000ff">/&gt;</span>    <br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">AssemblyPart</span> <span style="color: #ff0000">x:Name</span><span style="color: #0000ff">=&quot;FarseerPhysics&quot;</span> <span style="color: #ff0000">Source</span><span style="color: #0000ff">=&quot;bin/FarseerPhysics.dll&quot;</span> <span style="color: #0000ff">/&gt;</span><br />  <span style="color: #0000ff">&lt;/</span><span style="color: #800000">Deployment.Parts</span><span style="color: #0000ff">&gt;</span><br /><span style="color: #0000ff">&lt;/</span><span style="color: #800000">Deployment</span><span style="color: #0000ff">&gt;</span></pre>
<br /></div>
<div id="codeSnippetWrapper">This would probably be more interesting compared to a non dynamic language manifest file, but here are a few things I found interesting about it;</div>
<ul>
<li>There is a whole lot of additional referenced assemblies required to compile Pyhton code in the Silverlight client, and yes, they are included in the XAP sent to the client. </li>
<li>The FarseerPhysics assembly is also included the XAP and is referenced in the manifest. </li>
<li>The EntryPointType is really the only difference between XAP manifest files generated for statically typed languages. For dynamic languages there are additional assemblies that compile the dynamic code, there doesn’t seem any reason you couldn’t feasibly write EntryPoint assemblies that interpreted <a href="http://lolcode.com/">lol-cat</a> or <a href="http://www.muppetlabs.com/~breadbox/bf/">brainfuck</a> code. </li>
<li>And, I’m still targeting Silverlight 2! (Just haven’t got round to upgrading..)&#160; </li>
</ul>
<h2>Writing an application</h2>
<p>I started by having a play with the Farseer engine by writing some IronPython scripts and running them from the console. As it’s just a physics engine, it can be coupled with any user interface, even a console.</p>
<p>When I tried to get the same script working in Silverlight I did encounter some difficulties referencing the Farseer assembly. I had to use the assemblies strong name, which I found using <a href="http://www.red-gate.com/products/reflector/">Reflector</a>, but seems unnecessary given it was sent in the same XAP as the code referencing it! </p>
<p>Instead of just hacking this demo together in one giant script I decided to structure my code a little, including separating the view and the simulation model over different namespaces. Generally I’m learning heaps about what is pythonic, what I carry over from C/C++/C# and what is good software design.</p>
<p>I’m not entirely happy with my view classes, which are just wrappers around Silverlight controls. Even though the Silverlight control can be accessed through a property, I feel this isn’t the elegant solution I should be able to build in a dynamic language. It seemed more right for the physics wrappers, but still overly verbose.&#160;&#160;&#160; </p>
<h2>Conclusion</h2>
<p>I limited the example for this post to a very simple, but interactive 2d physics demo. Clicking any of the objects in the simulation creates a spring between the object and the mouse cursor until the mouse click is released or leaves the simulation view area.&#160; </p>
<div style="height: 300px"><iframe style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; width: 500px; height: 300px; border-right-width: 0px" src="http://static.sharpthinking.com.au/2009/2d_physics/physics_demo.html" scrolling="no"></iframe></div>
<p>&#160;</p>
<p>The Farseer physics engine is a lot of fun to use, it’s easy to get into and you can do some really cool stuff with it.</p>
<p>The <a href="http://static.sharpthinking.com.au/2009/2d_physics/physics.xap">source code</a> is sent as plain text and compiled (or interpreted) on client. As the XAP is just a normal zip file, it can unzipped by almost any zip tool. Inside is all the plain text source code, compiled assemblies and manifest file.&#160;&#160;&#160; </p>
<p><a href="http://blog.sharpthinking.com.au/image.axd?picture=WindowsLiveWriter/PhysicssimulationwithFarseerandPython/624647EA/image.png"><img title="image" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="102" alt="image" src="image_thumb.png" width="422" border="0" /></a>&#160;</p>
<p>It’s awesome to be able to develop Silverlight applications with physics libraries using a high level language and light weight development environment. Happy hacking.. </p>
<br />
</div>
